# Environment Variables

Consolidated reference for all environment controls. The primary config file on macOS and Linux is `/etc/edgecoder/edgecoder.env`. See [`scripts/macos/payload/etc/edgecoder/edgecoder.env.example`](https://github.com/edgecoder-io/edgecoder/blob/main/scripts/macos/payload/etc/edgecoder/edgecoder.env.example) for a fully-annotated template.

## Runtime mode

| Variable | Values | Description |
|---|---|---|
| `EDGE_RUNTIME_MODE` | `worker` \| `coordinator` \| `ide-provider` \| `control-plane` \| `inference` \| `all-in-one` | Selects which service the daemon runs as. Required. |

## Worker identity and enrollment

| Variable | Example | Description |
|---|---|---|
| `AGENT_ID` | `mac-worker-001` | Unique node identifier. Must match the enrolled node ID in the portal. |
| `AGENT_OS` | `macos` \| `ubuntu` \| `debian` \| `windows` \| `ios` | OS label reported to coordinator. |
| `AGENT_MODE` | `swarm-only` \| `ide-enabled` | Whether this agent also serves IDE inference requests. |
| `AGENT_CLIENT_TYPE` | `edgecoder-native` | Runtime flavor label. Keep default unless using a custom runtime. |
| `AGENT_REGISTRATION_TOKEN` | _(from Nodes page)_ | Required for EDGE_RUNTIME_MODE=worker. Generated by node enrollment in the portal. |

## Coordinator configuration

| Variable | Example | Description |
|---|---|---|
| `COORDINATOR_URL` | `https://coordinator.edgecoder.io` | URL of the coordinator this agent connects to. |
| `COORDINATOR_REGISTRATION_TOKEN` | _(from Nodes page)_ | Required for EDGE_RUNTIME_MODE=coordinator. |
| `COORDINATOR_PUBLIC_URL` | `https://coordinator.edgecoder.io` | Coordinator's publicly-reachable URL (used by coordinator itself). |
| `COORDINATOR_DISCOVERY_URL` | `https://control.edgecoder.io/network/coordinators` | Control-plane endpoint for coordinator autodiscovery. |
| `COORDINATOR_BOOTSTRAP_URLS` | `https://coordinator.edgecoder.io` | Comma-separated fallback list. |
| `COORDINATOR_HTTP_TIMEOUT_MS` | `15000` | HTTP timeout for coordinator API calls (ms). |
| `COORDINATOR_POST_RETRIES` | `2` | Retry count for coordinator POST requests on transient failure. |

## Model provider

| Variable | Values / Example | Description |
|---|---|---|
| `LOCAL_MODEL_PROVIDER` | `edgecoder-local` \| `ollama-local` | Inference backend. Use `ollama-local` when Ollama is installed. |
| `OLLAMA_MODEL` | `qwen2.5-coder:latest` | Model tag to use/pull when provider is `ollama-local`. |
| `OLLAMA_AUTO_INSTALL` | `true` \| `false` | Auto-pull the Ollama model on startup if not present. |
| `OLLAMA_HOST` | `http://127.0.0.1:11434` | Ollama daemon URL. Blank = default local host. |

## Mesh auth and security

| Variable | Description |
|---|---|
| `MESH_AUTH_TOKEN` | Shared mesh auth secret. Auto-provisioned by coordinator on successful registration if left blank. |
| `COORDINATOR_MESH_TOKEN` | Alias for `MESH_AUTH_TOKEN`. Keep aligned if both are set. |
| `INFERENCE_AUTH_TOKEN` | Auth token for the inference service API. |
| `ADMIN_API_TOKEN` | Admin token for control-plane operator APIs. |
| `PORTAL_SERVICE_TOKEN` | Internal service token for portal ↔ coordinator/control-plane calls. |

## Portal and passkeys

| Variable | Example | Description |
|---|---|---|
| `PORTAL_PUBLIC_URL` | `https://portal.edgecoder.io` | Public-facing portal URL (used in email links, OAuth redirect). |
| `PORTAL_DATABASE_URL` | `postgres://...` | Portal PostgreSQL connection string. |
| `PASSKEY_RP_ID` | `portal.edgecoder.io` | WebAuthn relying party ID (must match origin domain). |
| `PASSKEY_RP_NAME` | `EdgeCoder Portal` | Display name for WebAuthn credential creation. |
| `PASSKEY_ORIGIN` | `https://portal.edgecoder.io` | Expected WebAuthn origin. |
| `PASSKEY_CHALLENGE_TTL_MS` | `120000` | Passkey challenge expiry (ms). |

## Key provider and rotation

| Variable | Values | Description |
|---|---|---|
| `KEY_PROVIDER` | `env` \| `hsm` \| `tpm` \| `secure-enclave` | Signing key backend. Default: `env`. |
| `HSM_PKCS11_LIB` | `/usr/lib/libpkcs11.so` | Path to PKCS#11 shared library (required when `KEY_PROVIDER=hsm`). |
| `HSM_SLOT_ID` | `0` | HSM slot identifier. |
| `HSM_PIN` | _(secret)_ | HSM user PIN. |
| `KEY_ROTATION_DAYS` | `90` | Maximum days between key rotations. |

## Bluetooth Local (BLE proxy — Mac IDE mode)

Used by the IDE provider server (`EDGE_RUNTIME_MODE=ide-provider`) to bridge the Mac-side IntelligentRouter to a nearby iPhone over Bluetooth.

| Variable | Default | Description |
|---|---|---|
| `BT_PROXY_PORT` | `11435` | Port the Swift `edgecoder-ble-proxy` companion listens on. |
| `BT_PROXY_HOST` | `127.0.0.1` | Host for the BLE proxy HTTP API. Always loopback in production. |
| `BT_PROXY_URL` | `http://127.0.0.1:11435` | Full URL the IntelligentRouter calls for bluetooth-local inference. Overrides `BT_PROXY_HOST` + `BT_PROXY_PORT`. |
| `BT_STATUS_URL` | _(auto-set)_ | Status endpoint checked by the router to decide if BT is available. Set automatically from `BT_PROXY_HOST:BT_PROXY_PORT`. |

The `edgecoder-ble-proxy` binary must be installed first:
```bash
npm run build:ble-proxy
# Installs to /opt/edgecoder/bin/edgecoder-ble-proxy
```

## Task and performance tuning

| Variable | Default | Description |
|---|---|---|
| `MAX_CONCURRENT_TASKS` | `1` | Parallel task limit per agent. Increase gradually only on machines with headroom. |
| `PEER_OFFER_COOLDOWN_MS` | `20000` | Cooldown between peer-direct offers while idle (ms). Lower = more aggressive. |

## iOS power telemetry (reported by iOS agents)

| Variable | Description |
|---|---|
| `IOS_ON_EXTERNAL_POWER` | `true`/`false` — device is charging |
| `IOS_BATTERY_LEVEL_PCT` | Battery percentage (0–100) |
| `IOS_LOW_POWER_MODE` | `true`/`false` — iOS Low Power Mode active |
| `IOS_BATTERY_PULL_MIN_INTERVAL_MS` | Throttle between assignment attempts on battery |
| `IOS_BATTERY_TASK_STOP_LEVEL_PCT` | Minimum battery level before stopping assignment |

## Bitcoin anchoring

| Variable | Default | Description |
|---|---|---|
| `BITCOIN_ANCHOR_PROVIDER` | `mock` | Provider type: `anchor-proxy`, `bitcoind`, `blockstream`, `mock`. |
| `BITCOIN_NETWORK` | `signet` | Must match across all coordinators in the mesh. |
| `ANCHOR_PROXY_URL` | — | URL of the anchor proxy service (when provider is `anchor-proxy`). |
| `ANCHOR_PROXY_TOKEN` | — | Bearer token for anchor proxy auth. |
| `BITCOIND_RPC_URL` | — | Direct bitcoind RPC URL (when provider is `bitcoind`). |
| `BITCOIND_RPC_USER` | — | RPC username. |
| `BITCOIND_RPC_PASSWORD` | — | RPC password. |
| `BITCOIND_WALLET_NAME` | — | Wallet name on the Bitcoin node. |
| `ANCHOR_CONFIRMATION_POLL_MS` | `60000` | Poll interval for pending anchors (ms). |
| `STATS_ANCHOR_MIN_CONFIRMATIONS` | `1` | Block confirmations before promoting anchor status. |
| `ANCHOR_PROXY_PORT` | `4310` | Listen port for the anchor proxy service. |
| `MAX_BROADCASTS_PER_MINUTE` | `10` | Rate limit for OP_RETURN broadcasts (anchor proxy). |

## Wallet and economy

| Variable | Description |
|---|---|
| `WALLET_DEFAULT_NETWORK` | Default chain/network for wallet operations. |
| `WALLET_SECRET_PEPPER` | Server-side pepper for wallet key derivation. |
| `COORDINATOR_FEE_BPS` | Coordinator fee in basis points. |
| `COORDINATOR_FEE_ACCOUNT` | Fee recipient account address. |
| `PAYMENT_INTENT_TTL_MS` | Payment intent expiry (ms). |

## Network and infrastructure

| Variable | Description |
|---|---|
| `NETWORK_MODE` | `public_mesh` or `enterprise_overlay` — mesh network policy mode. |
| `CONTROL_PLANE_URL` | Control-plane service URL for coordinator/worker autodiscovery. |
| `NODE_BIN` | Override Node.js binary path if auto-detection fails (macOS/Linux daemon). |
| `DOCS_SITE_URL` | Documentation site URL (used in portal links). |
| `GITHUB_REPO_URL` | Repository URL for changelog/release links. |

## Common profiles

```bash
# 1) Standard mesh worker (most common)
EDGE_RUNTIME_MODE=worker
AGENT_ID=my-node-001
AGENT_OS=macos
AGENT_REGISTRATION_TOKEN=<from portal>
COORDINATOR_URL=https://coordinator.edgecoder.io

# 2) Worker + IDE-capable agent
EDGE_RUNTIME_MODE=worker
AGENT_MODE=ide-enabled

# 3) Dedicated coordinator
EDGE_RUNTIME_MODE=coordinator
COORDINATOR_REGISTRATION_TOKEN=<from portal>
DATABASE_URL=<postgres>

# 4) Local Ollama inference
LOCAL_MODEL_PROVIDER=ollama-local
OLLAMA_MODEL=qwen2.5-coder:latest
OLLAMA_AUTO_INSTALL=true
```

## Operational guidance

- Keep secrets in production secret stores (Fly Secrets, AWS SSM, etc.) rather than static env files.
- On macOS, the env file is `/etc/edgecoder/edgecoder.env` (chmod 600, owned by root).
- On Linux, same path — the systemd `EnvironmentFile=-/etc/edgecoder/edgecoder.env` directive loads it.
- Review and rotate `MESH_AUTH_TOKEN` periodically.

## Cross-links

- [Deployment Topology](/operations/deployment-topology)
- [iOS Background Execution](/operations/ios-power-scheduling)
- [macOS env example](https://github.com/edgecoder-io/edgecoder/blob/main/scripts/macos/payload/etc/edgecoder/edgecoder.env.example)
